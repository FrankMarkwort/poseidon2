<!DOCTYPE html>
<html>

<head>
    <title>Gauge Chart Example</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/11.1.0/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>


</head>

<body>
    <div id="chart-container" style="width: 400px; height: 300px;"></div>

    <script>
        var container = document.createElement('div');
        document.body.appendChild(container);


        (async () => {

        // Load the dataset
        const data = await fetch(
            'https://localhost/index.phtml?pgn=130306&mode=json'
        ).then(response => response.json());

        window.chart = new Highcharts.Chart({

            chart: {
                renderTo: container,
                height: 400,
                type: 'gauge',
                plotBackgroundColor: null,
                plotBackgroundImage: null,
                plotBorderWidth: 0,
                plotShadow: false,
            },

            title: {
                text: 'Humidity'
            },

            pane: {
                startAngle: -90,
                endAngle: 89.9,
                background: null,
                center: ['50%', '75%'],
                size: '110%'
            },

            // the value axis
            yAxis: {
                min: 0,
                max: 100,
                tickPixelInterval: 72,
                tickPosition: 'inside',
                tickColor: Highcharts.defaultOptions.chart.backgroundColor || '#FFFFFF',
                tickLength: 30,
                tickWidth: 2,
                minorTickInterval: null,
                labels: {
                    distance: 15,
                    style: {
                        fontSize: '14px'
                    }
                },

                lineWidth: 0,
                plotBands: [{
                    from: 0,
                    to: 20,
                    color: {
                        linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                        stops: [
                            [0, '#ff8000'], //yellow
                            [1, '#DF5353'] //green
                        ]
                    },
                    thickness: 30
                }, {
                    from: 20,
                    to: 40,
                    color: {
                        linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                        stops: [
                            [0, '#DDDF0D'], //yellow
                            [1, '#ff8000'] //green
                        ]
                    },
                    thickness: 30
                }, {
                    from: 40,
                    to: 60,
                    color: {
                        linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                        stops: [
                            [0, '#DDDF0D'], //yellow
                            [1, '#DDDF0D'] //green
                        ]
                    },
                    thickness: 30
                }, {
                    from: 60,
                    to: 80,
                    color: {
                        linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                        stops: [
                            [0, '#DDDF0D'], //yellow
                            [1, '#55BF3B'] //green
                        ]
                    },
                    thickness: 30
                }, {
                    from: 80,
                    to: 100,
                    color: {
                        linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                        stops: [
                            [0, '#55BF3B'], //yellow
                            [1, '#27C0F0'] //green
                        ]
                    },
                    thickness: 30
                }]
            },

            series: [{
                name: 'Humidity',
                data: [10],
                tooltip: {
                    valueSuffix: ' %'
                },
                dataLabels: {
                    format: '{y} %',
                    borderWidth: 0,
                    color: (
                        Highcharts.defaultOptions.title &&
                        Highcharts.defaultOptions.title.style &&
                        Highcharts.defaultOptions.title.style.color
                    ) || '#333333',
                    style: {
                        fontSize: '16px'
                    }
                },
                dial: {
                    radius: '90%',
                    backgroundColor: 'black',
                    baseWidth: 12,
                    baseLength: '0%',
                    rearLength: '0%'
                },
                pivot: {
                    backgroundColor: 'gray',
                    radius: 6
                }

            }]
        });

        // Set up socket connection
        var socket = new WebSocket('ws://localhost:1234/socket'); // Replace with your socket server's host and port

        // Listen for socket connection established
        socket.onopen = function (event) {
            console.log('WebSocket connection established.');
        };

        // Listen for socket messages
        socket.onmessage = function (event) {
            var value = parseInt(event.data);
            console.log("On message " + value);
            chart.series[0].points[0].update(value);
        };

    </script>
</body>

</html>